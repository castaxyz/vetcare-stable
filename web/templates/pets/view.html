{% extends "base.html" %}

{% block title %}{{ pet_summary.pet.name }} - Detalles - VetCare{% endblock %}

{% block extra_css %}
<style>
    .pet-header {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        border-left: 5px solid var(--primary-color);
    }
    
    .pet-avatar {
        width: 120px;
        height: 120px;
        background: var(--primary-color);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        color: white;
        margin-bottom: 1rem;
    }
    
    .info-card {
        background: #fff;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        border-left: 4px solid var(--primary-color);
    }
    
    .info-card h5 {
        color: var(--primary-color);
        margin-bottom: 1rem;
        font-weight: 600;
    }
    
    .info-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 0;
        border-bottom: 1px solid #f1f3f4;
    }
    
    .info-item:last-child {
        border-bottom: none;
    }
    
    .info-label {
        font-weight: 500;
        color: #6c757d;
        display: flex;
        align-items: center;
    }
    
    .info-label i {
        margin-right: 0.5rem;
        width: 16px;
    }
    
    .info-value {
        font-weight: 600;
    }
    
    .status-badge {
        font-size: 0.875rem;
        padding: 0.5rem 1rem;
        border-radius: 20px;
    }
    
    .appointment-item {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 0.75rem;
        border-left: 4px solid #dee2e6;
    }
    
    .appointment-item.completed {
        border-left-color: #28a745;
    }
    
    .appointment-item.scheduled {
        border-left-color: #17a2b8;
    }
    
    .appointment-item.cancelled {
        border-left-color: #dc3545;
    }
    
    .quick-actions {
        position: sticky;
        top: 20px;
    }
    
    @media (max-width: 768px) {
        .pet-header {
            text-align: center;
        }
        
        .pet-avatar {
            margin: 0 auto 1rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    {% set pet = pet_summary.pet %}
    {% set owner = pet_summary.owner %}
    
    <!-- Header de la Mascota -->
    <div class="pet-header">
        <div class="row align-items-center">
            <div class="col-md-8">
                <div class="d-flex align-items-center">
                    <div class="pet-avatar">
                        {% if pet.species.value == 'dog' %}
                            üêï
                        {% elif pet.species.value == 'cat' %}
                            üê±
                        {% elif pet.species.value == 'bird' %}
                            üê¶
                        {% elif pet.species.value == 'rabbit' %}
                            üê∞
                        {% elif pet.species.value == 'hamster' %}
                            üêπ
                        {% elif pet.species.value == 'fish' %}
                            üê†
                        {% else %}
                            üêæ
                        {% endif %}
                    </div>
                    <div class="ms-3">
                        <h1 class="mb-1">
                            {{ pet.name }}
                            {% if not pet.is_active %}
                                <span class="badge bg-secondary ms-2">Inactiva</span>
                            {% endif %}
                        </h1>
                        <h5 class="text-muted mb-2">
                            {{ pet.species.value.title() }}
                            {% if pet.breed %} - {{ pet.breed }}{% endif %}
                        </h5>
                        {% if owner %}
                        <p class="mb-0">
                            <i class="bi bi-person me-2"></i>
                            <strong>Propietario:</strong> 
                            <a href="{{ url_for('clients.view_client', client_id=owner.id) }}" class="text-decoration-none">
                                {{ owner.full_name }}
                            </a>
                            {% if owner.phone %}
                                <span class="text-muted">- {{ owner.phone }}</span>
                            {% endif %}
                        </p>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-md-4 text-end">
                <div class="btn-group" role="group">
                    <a href="{{ url_for('pets.edit_pet', pet_id=pet.id) }}" class="btn btn-outline-primary">
                        <i class="bi bi-pencil me-2"></i>Editar
                    </a>
                    <a href="{{ url_for('appointments.create_appointment') }}?pet_id={{ pet.id }}" 
                       class="btn btn-primary">
                        <i class="bi bi-calendar-plus me-2"></i>Nueva Cita
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Informaci√≥n Principal -->
        <div class="col-lg-8">
            <!-- Informaci√≥n B√°sica -->
            <div class="info-card">
                <h5><i class="bi bi-info-circle me-2"></i>Informaci√≥n B√°sica</h5>
                
                <div class="info-item">
                    <span class="info-label">
                        <i class="bi bi-tag"></i>Especie
                    </span>
                    <span class="info-value">{{ pet.species.value.title() }}</span>
                </div>
                
                {% if pet.breed %}
                <div class="info-item">
                    <span class="info-label">
                        <i class="bi bi-bookmark"></i>Raza
                    </span>
                    <span class="info-value">{{ pet.breed }}</span>
                </div>
                {% endif %}
                
                <div class="info-item">
                    <span class="info-label">
                        {% if pet.gender.value == 'male' %}
                            <i class="bi bi-gender-male"></i>
                        {% elif pet.gender.value == 'female' %}
                            <i class="bi bi-gender-female"></i>
                        {% else %}
                            <i class="bi bi-question"></i>
                        {% endif %}
                        Sexo
                    </span>
                    <span class="info-value">
                        <span class="badge bg-{{ 'primary' if pet.gender.value == 'male' else 'pink' if pet.gender.value == 'female' else 'secondary' }}">
                            {% if pet.gender.value == 'male' %}
                                Macho
                            {% elif pet.gender.value == 'female' %}
                                Hembra
                            {% else %}
                                No especificado
                            {% endif %}
                        </span>
                    </span>
                </div>
                
                {% if pet.birth_date %}
                <div class="info-item">
                    <span class="info-label">
                        <i class="bi bi-calendar"></i>Fecha de Nacimiento
                    </span>
                    <span class="info-value">
                        {{ pet.birth_date.strftime('%d/%m/%Y') }}
                        {% if pet.age_in_years %}
                            <small class="text-muted">({{ pet.age_in_years }} a√±o{{ 's' if pet.age_in_years != 1 else '' }})</small>
                        {% endif %}
                    </span>
                </div>
                {% endif %}
                
                {% if pet.color %}
                <div class="info-item">
                    <span class="info-label">
                        <i class="bi bi-palette"></i>Color
                    </span>
                    <span class="info-value">{{ pet.color }}</span>
                </div>
                {% endif %}
                
                {% if pet.weight %}
                <div class="info-item">
                    <span class="info-label">
                        <i class="bi bi-speedometer"></i>Peso
                    </span>
                    <span class="info-value">{{ pet.weight }} kg</span>
                </div>
                {% endif %}
                
                {% if pet.microchip_number %}
                <div class="info-item">
                    <span class="info-label">
                        <i class="bi bi-qr-code"></i>Microchip
                    </span>
                    <span class="info-value">{{ pet.microchip_number }}</span>
                </div>
                {% endif %}
            </div>

            <!-- Historial de Citas -->
            <div class="info-card">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5><i class="bi bi-calendar-check me-2"></i>Historial de Citas</h5>
                    <a href="{{ url_for('appointments.list_appointments') }}?pet_id={{ pet.id }}" 
                       class="btn btn-sm btn-outline-primary">
                        <i class="bi bi-eye me-1"></i>Ver Todas
                    </a>
                </div>
                
                {% if recent_appointments %}
                    {% for appointment in recent_appointments %}
                    <div class="appointment-item {{ appointment.status.value }}">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">
                                    {{ appointment.appointment_date.strftime('%d/%m/%Y a las %H:%M') }}
                                </h6>
                                <p class="mb-1 text-muted">
                                    <strong>Tipo:</strong> {{ appointment.appointment_type.value.title() }}
                                </p>
                                {% if appointment.reason %}
                                <p class="mb-1 text-muted">
                                    <strong>Motivo:</strong> {{ appointment.reason }}
                                </p>
                                {% endif %}
                            </div>
                            <span class="badge bg-{{ 'success' if appointment.status.value == 'completed' else 'info' if appointment.status.value == 'scheduled' else 'danger' if appointment.status.value == 'cancelled' else 'secondary' }}">
                                {% if appointment.status.value == 'completed' %}
                                    Completada
                                {% elif appointment.status.value == 'scheduled' %}
                                    Programada
                                {% elif appointment.status.value == 'confirmed' %}
                                    Confirmada
                                {% elif appointment.status.value == 'cancelled' %}
                                    Cancelada
                                {% else %}
                                    {{ appointment.status.value.title() }}
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-calendar-x text-muted" style="font-size: 2rem;"></i>
                        <p class="text-muted mt-2">No hay citas registradas</p>
                        <a href="{{ url_for('appointments.create_appointment') }}?pet_id={{ pet.id }}" 
                           class="btn btn-primary btn-sm">
                            <i class="bi bi-calendar-plus me-1"></i>Programar Primera Cita
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Panel Lateral -->
        <div class="col-lg-4">
            <!-- Acciones R√°pidas -->
            <div class="info-card quick-actions">
                <h5><i class="bi bi-lightning me-2"></i>Acciones R√°pidas</h5>
                
                <div class="d-grid gap-2">
                    <a href="{{ url_for('appointments.create_appointment') }}?pet_id={{ pet.id }}" 
                       class="btn btn-primary">
                        <i class="bi bi-calendar-plus me-2"></i>Nueva Cita
                    </a>
                    
                    <a href="{{ url_for('pets.edit_pet', pet_id=pet.id) }}" 
                       class="btn btn-outline-primary">
                        <i class="bi bi-pencil me-2"></i>Editar Informaci√≥n
                    </a>
                    
                    {% if owner %}
                    <a href="{{ url_for('clients.view_client', client_id=owner.id) }}" 
                       class="btn btn-outline-secondary">
                        <i class="bi bi-person me-2"></i>Ver Propietario
                    </a>
                    {% endif %}
                    
                    <a href="{{ url_for('pets.list_pets') }}" 
                       class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left me-2"></i>Volver a Lista
                    </a>
                </div>
            </div>

            <!-- Informaci√≥n del Sistema -->
            <div class="info-card">
                <h5><i class="bi bi-gear me-2"></i>Informaci√≥n del Sistema</h5>
                
                <div class="info-item">
                    <span class="info-label">
                        <i class="bi bi-calendar-plus"></i>Registrada
                    </span>
                    <span class="info-value">
                        {{ pet.created_at.strftime('%d/%m/%Y') if pet.created_at else 'No disponible' }}
                    </span>
                </div>
                
                {% if pet.updated_at %}
                <div class="info-item">
                    <span class="info-label">
                        <i class="bi bi-pencil-square"></i>√öltima Actualizaci√≥n
                    </span>
                    <span class="info-value">
                        {{ pet.updated_at.strftime('%d/%m/%Y') }}
                    </span>
                </div>
                {% endif %}
                
                <div class="info-item">
                    <span class="info-label">
                        <i class="bi bi-toggle-on"></i>Estado
                    </span>
                    <span class="info-value">
                        <span class="status-badge bg-{{ 'success' if pet.is_active else 'secondary' }} text-white">
                            {% if pet.is_active %}
                                <i class="bi bi-check-circle me-1"></i>Activa
                            {% else %}
                                <i class="bi bi-archive me-1"></i>Inactiva
                            {% endif %}
                        </span>
                    </span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">
                        <i class="bi bi-hash"></i>ID Sistema
                    </span>
                    <span class="info-value">#{{ pet.id }}</span>
                </div>
            </div>

            <!-- Estad√≠sticas -->
            <div class="info-card">
                <h5><i class="bi bi-bar-chart me-2"></i>Estad√≠sticas</h5>
                
                <div class="info-item">
                    <span class="info-label">
                        <i class="bi bi-calendar-check"></i>Total de Citas
                    </span>
                    <span class="info-value">
                        <span class="badge bg-primary">{{ recent_appointments|length if recent_appointments else 0 }}</span>
                    </span>
                </div>
                
                {% if pet.age_in_years %}
                <div class="info-item">
                    <span class="info-label">
                        <i class="bi bi-hourglass"></i>Edad
                    </span>
                    <span class="info-value">{{ pet.age_in_years }} a√±o{{ 's' if pet.age_in_years != 1 else '' }}</span>
                </div>
                {% endif %}
                
                {% if owner and owner.phone %}
                <div class="info-item">
                    <span class="info-label">
                        <i class="bi bi-telephone"></i>Contacto
                    </span>
                    <span class="info-value">
                        <a href="tel:{{ owner.phone }}" class="text-decoration-none">
                            {{ owner.phone }}
                        </a>
                    </span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Agregar tooltips a los badges
    $('[data-bs-toggle="tooltip"]').tooltip();
    
    // Efecto hover en las cards de informaci√≥n
    $('.info-card').hover(
        function() {
            $(this).css('transform', 'translateY(-2px)');
            $(this).css('box-shadow', '0 4px 8px rgba(0,0,0,0.15)');
        },
        function() {
            $(this).css('transform', 'translateY(0)');
            $(this).css('box-shadow', '0 2px 4px rgba(0,0,0,0.1)');
        }
    );
    
    // Smooth transitions
    $('.info-card').css('transition', 'all 0.2s ease-in-out');
});
</script>
{% endblock %}